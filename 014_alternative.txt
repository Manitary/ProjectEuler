N:=10^6;
max_len:=1;
best:=1;
visited:=[1];
lengths:=[1];

procedure checklength(chain,~visited,~lengths)
	n:=chain[#chain];
	if n in visited then
		for i in [1..#chain-1] do
			Append(~visited,chain[i]);
			Append(~lengths,#chain-i+lengths[Index(visited,n)]);
		end for;
	else
		checklength(Append(chain,n mod 2 eq 0 select n div 2 else 3*n+1),~visited,~lengths);
	end if;
end procedure;

for n in [2..N] do
	checklength([n],~visited,~lengths);
end for;
_,b:=Max(Lengths);
visited[b];